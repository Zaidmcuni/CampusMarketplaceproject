{% extends 'base.html' %}

{% block content %}
<div style="max-width: 800px; margin: 2rem auto; display: flex; flex-direction: column; height: 80vh;">
    
    <div style="padding: 1rem; background: white; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between;">
        <h3 style="margin: 0;">Conversation with <span style="color: var(--mcgill-red);">{{ other_user.username }}</span></h3>
        <a href="{% url 'inbox' %}" style="color: #666; font-size: 0.9rem;">‚Üê Back to Inbox</a>
    </div>

    <div style="flex: 1; overflow-y: auto; padding: 2rem; background: #f8f9fa; display: flex; flex-direction: column; gap: 1rem;">
        {% for msg in messages %}
            <div style="max-width: 70%; padding: 1rem; border-radius: 15px; line-height: 1.4; 
                {% if msg.sender == request.user %}
                    align-self: flex-end; background: var(--mcgill-red); color: white; border-bottom-right-radius: 2px;
                {% else %}
                    align-self: flex-start; background: white; color: #333; border: 1px solid #ddd; border-bottom-left-radius: 2px;
                {% endif %}">
                {{ msg.content }}
                <div style="font-size: 0.7rem; opacity: 0.7; margin-top: 0.5rem; text-align: right;">
                    {{ msg.created_at|date:"g:i A" }}
                </div>
            </div>
        {% empty %}
            <p style="text-align: center; color: #999; margin-top: 2rem;">No messages yet. Say hello! üëã</p>
        {% endfor %}
    </div>

    <div style="background: white; padding: 1.5rem; border-top: 1px solid #ddd;">
        <form method="POST" style="display: flex; gap: 1rem;">
            {% csrf_token %}
            <input type="text" name="content" required placeholder="Type a message..." autofocus
                   style="flex: 1; padding: 1rem; border: 2px solid #ddd; border-radius: 50px; outline: none;">
            <button type="submit" class="btn" style="border-radius: 50px; padding: 0 2rem;">Send ‚û§</button>
        </form>
    </div>
</div>

<script>
    window.onload = function() {
        const chatBox = document.querySelector('div[style*="overflow-y: auto"]');
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>
{% endblock %}