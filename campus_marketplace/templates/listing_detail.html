{% extends 'base.html' %}

{% block content %}
<div style="background: white; border-radius: 20px; box-shadow: var(--shadow-light); overflow: hidden; max-width: 900px; margin: 2rem auto;">
    
    <div style="display: flex; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 300px; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
            {% if listing.image %}
                <img src="{{ listing.image.url }}" alt="{{ listing.title }}" style="width: 100%; height: auto; max-height: 500px; object-fit: contain;">
            {% else %}
                <div style="font-size: 5rem; color: #ccc; padding: 4rem;">ğŸ“¦</div>
            {% endif %}
        </div>

        <div style="flex: 1; min-width: 300px; padding: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <h1 style="margin: 0; color: #2c3e50;">{{ listing.title }}</h1>
                <span style="background: #e9ecef; padding: 0.5rem 1rem; border-radius: 50px; font-size: 0.9rem;">
                    ğŸ“ {{ listing.get_residence_display }}
                </span>
            </div>

            {% if listing.price %}
                <div class="price" style="font-size: 2rem; margin: 1rem 0;">${{ listing.price }}</div>
            {% else %}
                <div class="price" style="font-size: 1.5rem; margin: 1rem 0; color: #666; font-style: italic;">
                    ğŸ’¬ Price on Request
                </div>
            {% endif %}

            <p style="color: #555; line-height: 1.7; margin-bottom: 2rem; font-size: 1.1rem;">
                {{ listing.description }}
            </p>

            <div style="border-top: 1px solid #eee; padding-top: 1.5rem;">
                <p style="color: #888; margin-bottom: 1rem; font-size: 0.9rem;">
                    Sold by <strong>{{ listing.seller.username }}</strong> on {{ listing.createdat|date:"M d, Y" }}
                </p>

                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    {% if request.user == listing.seller %}
                        <a href="{% url 'edit_listing' listing.id %}" class="btn" style="background: #007bff;">âœï¸ Edit</a>
                        
                        {% if not listing.is_sold %}
                            <form method="POST" action="{% url 'mark_sold' listing.id %}">
                                {% csrf_token %}
                                <button type="submit" class="btn" style="background: #28a745;">âœ… Mark Sold</button>
                            </form>
                        {% else %}
                            <button class="btn" disabled style="background: #ccc; cursor: not-allowed;">ğŸš« Item Sold</button>
                        {% endif %}

                        <form method="POST" action="{% url 'delete_listing' listing.id %}" onsubmit="return confirm('Delete this item?');">
                            {% csrf_token %}
                            <button type="submit" class="btn" style="background: #dc3545;">ğŸ—‘ï¸ Delete</button>
                        </form>
                    {% else %}
                        {% if not listing.is_sold %}
                            <a href="/messages/chat/{{ listing.seller.id }}/" class="btn">ğŸ’¬ Chat with Seller</a>
                        {% else %}
                            <button class="btn" disabled style="background: #ccc;">ğŸš« Item Sold</button>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}